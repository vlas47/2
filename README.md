# Realty Portal (Setl Import)

Проект представляет собой Django‑сайт с промостраницей «Союза Застройщиков» и служебным модулем работы с большой XML‑базой недвижимости Setl. Основные цели:

- показать рекламную страницу о Петербурге (герой, история, достижения, CTA);
- хранить и визуализировать десятки тысяч предложений из фида Setl (`Setl_XML`);
- быстро фильтровать, сортировать и просматривать объекты (квартиры, дома, участки и т.д.) прямо из служебного раздела.

## Архитектура

- **Django 5.2** — основной фреймворк.
- **PostgreSQL** — основная БД (настроена в `settings.py`).
- Приложения:
  - `listings` — публичная главная страница.
  - `newbuildings`, `secondary`, `countryside`, `adminportal` — тематические разделы.
  - `realestate` — служебная база недвижимости и инструменты импорта.
- Статические файлы лежат в `static/`, шаблоны — в `templates/`.

## Модуль `realestate`

- Модель `RealtyOffer` описывает более 40 полей: статусы сделки, координаты, адрес, категорию, набор цен, все доступные площади (общая, жилая, кухня, балкон, участок), высоту потолков, этажность, признаки «новостройка/студия/апартаменты», характеристики дома, ссылки на фото и резервные поля.
- Импорт осуществляется командой:

```bash
python manage.py import_setl --path Setl_XML
```

Команда потоково парсит XML (без загрузки целиком в память) и обновляет записи по `internal_id`.

- Служебный интерфейс доступен по `/realestate/`: таблица с фильтрами (по адресу, району, типу, категории, диапазону цены, количеству комнат), сортировками и чекбоксом «Только с фото». Показано первые 200 записей, чтобы страницы не перегружались.

## Запуск проекта

```bash
python -m venv venv
source venv/Scripts/activate  # Windows PowerShell: .\venv\Scripts\Activate.ps1
pip install -r requirements.txt
python manage.py migrate
python manage.py import_setl --path Setl_XML
python manage.py runserver
```

Публичная страница доступна на `/`, служебная база — `/realestate/`.

## Дневник разработки

История действий фиксируется в `DIARY.md`. Добавляй новые записи после каждого блока работы.

## Подготовка к публикации

Локальный репозиторий можно инициализировать командами:

```bash
git init
git add .
git commit -m "Initial project state"
```

Далее создайте пустой репозиторий на GitHub и свяжите его:

```bash
git remote add origin https://github.com/<username>/<repo>.git
git push -u origin main
```

> В этом окружении невозможна авторизация в GitHub, поэтому добавление удалённого репозитория и `push` нужно выполнить на вашей машине (по SSH или HTTPS‑токену).

## Раздел администратора и доступы

- Созданы роли «Администратор» и «Менеджер», миграция автоматически заводит пользователя `admin`/`admin` с правами суперпользователя и в группе «Администратор».
- Доступ в админ‑раздел `/admin-panel/` требует авторизации: после входа администратор попадает на панель, менеджер — в базу недвижимости.
- Страница входа: `/admin-panel/login/`, компактная форма, кнопка «Вход» на главной ведёт туда же.
